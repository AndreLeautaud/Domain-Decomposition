\section{Additive Schwarz}
\label{sec:Additive_Schwarz}

\subsection{Forward problem}
\label{sec:AS_forward_problem}

We define
\begin{equation}
\label{eq:ABCf2}
\begin{gathered}\begin{aligned}
A_i &= R_i A R_i^\top, \in \bbR^{m_i \times m_i}, \; i = 1, 2, \dots, p, \\
B_i &= R_i^\top A_i^{-1} R_i
     = R_i^\top \left( R_i A R_i^\top \right)^{-1} R_i \in \bbR^{n \times n}, \; i = 1, 2, \dots, p, \\
C_i &= B_i A \in \bbR^{n \times n}, \; i = 1, 2, \dots, p, \\
f_i &= B_i f \in \bbR^n, \; i = 1, 2, \dots, p.
\end{aligned}\end{gathered}
\end{equation}

\bigskip
\noindent\underline{Single iteration:} \quad
The additive Schwarz algorithm is: Given $u^{\{0\}}$ and $\alpha < 1$, for $k = 1, 2,  \dots$
\begin{equation}
\label{eq:additive_Schwarz_basic}
\begin{gathered}\begin{aligned}
u^{\{k\}} &= u^{\{k-1\}} + \alpha \sum_{i=1}^p B_i \left( f - A u^{\{k-1\}} \right),   \\
&= \left( I - \alpha \sum_{i=1}^p B_i A \right) u^{\{k-1\}} + \alpha \sum_{i=1}^p B_i f \\
&= \left( I - \alpha \sum_{i=1}^p C_i \right) u^{\{k-1\}} + \alpha \sum_{i=1}^p f_i \\
&= D u^{\{k-1\}} + g,
\end{aligned}\end{gathered}
\end{equation}
where
\begin{equation}
D= I - \alpha \sum_{i=1}^p C_i \quad\hbox{and}\quad g= \alpha \sum_{i=1}^p f_i.
\end{equation}


Note that relaxation is required.

\bigskip
\noindent\underline{$K$ iterations:} \quad
Using this notation, $K=6$ iterations of additive Schwarz can be written as the $nK$ dimensional system of equations
\begin{equation}
\label{eq:additive_Schwarz_forward}
U=
\left[
\begin{matrix}
  I &  0 &  0 &  0 &  0 & 0   \\
 -D &  I &  0 &  0 &  0 & 0   \\
  0 & -D &  I &  0 &  0 & 0   \\
  0 &  0 & -D &  I &  0 & 0   \\
  0 &  0 &  0 & -D &  I & 0   \\
  0 &  0 &  0 &  0 & -D & I
\end{matrix}
\right]
\left(
\begin{matrix}
u^{\{1\}}  \\
u^{\{2\}}  \\
u^{\{3\}}  \\
u^{\{4\}}  \\
u^{\{5\}}  \\
u^{\{6\}}
\end{matrix}
\right)
=
\left(
\begin{matrix}
g  \\
g  \\
g  \\
g  \\
g  \\
g
\end{matrix}
\right).
\end{equation}
This system $nK$ linear equations can be solved (blockwise) by forward substitution. Furthermore, the subdomain components of the $n$-dimensional systems of equations within each block can be solved in parallel.

\subsection{Adjoint equations}
\label{sec:AS_adjoint_problem}
The adjoint system of equations of size $nK$ to \eqref{eq:additive_Schwarz_forward} is
\begin{equation*}
U^\top x
= \left[
\begin{matrix}
   I      &  -D^\top  &     0     &   0       &   0       \\
   0      &     I     &  -D^\top  &   0       &   0       \\
   0      &     0     &     I     &  -D^\top  &   0       \\
   0      &     0     &     0     &   I       &  -D^\top  \\
   0      &     0     &     0     &   0       &   I
\end{matrix}
\right]
\left(
\begin{matrix}
\phi^{\{1\}}  \\
\phi^{\{2\}}  \\
\phi^{\{3\}}  \\
\phi^{\{4\}}  \\
\phi^{\{5\}}  \\
\phi^{\{6\}}
\end{matrix}
\right)
=
\left(
\begin{matrix}
0  \\
0  \\
0  \\
0  \\
0  \\
\psi
\end{matrix}
\right),
\end{equation*}
where $\psi \in \bbR^{n}$. This system $nK$ linear equations can be solved (blockwise) by backward substitution. Furthermore, the $n$-dimensional systems of equations within each block can be solved in parallel. Finally, note that
\begin{equation}
\begin{gathered}\begin{aligned}
\phi^{\{K\}} &= \psi \\
\phi^{\{K-1\}} &= D^\top \phi^{\{K\}} = D^\top \psi \\
&\qquad \vdots \\
\phi^{\{1\}} &= \underbrace{D^\top  \dots  D^\top}_{k \; {\rm times}} \psi.
\end{aligned}\end{gathered}
\end{equation}


\subsection{Discretization error representation}
\label{sec:AS_discretization_error_representation}
The error in the QoI defined by \eqref{eq:QoI} is given by the inner product
\begin{equation}
\label{eq:AS_error_representation}
\hbox{Discretization error in QoI} = (\psi, u^{\{K\}}-\hat{u}^{\{K\}}) = (R, \Phi),
\end{equation}
where $R$ is $nK$-dimensional vector of residuals and
\begin{equation}
\Phi = \left( \begin{matrix} \phi^{\{1\}} \\ \phi^{\{2\}} \\ \vdots \\ \phi^{\{K\}} \end{matrix} \right).
\end{equation}


\subsection{Total error representation}
\label{sec:AS_total_error_representation}
Assuming the global adjoint problem \eqref{eq:global_adjoint} can be solved for global adjoint solution $\phi$, i.e., solving \eqref{eq:global_adjoint}
\begin{equation*}
A^\top \phi= \psi,
\end{equation*}
and defining residual
\begin{equation}
r= f-A\hat{u}^{\{K\}},
\end{equation}
then
\begin{equation}
\hbox{Total error in QoI} = (r,\phi)
\end{equation}
and
\begin{equation}
\hbox{Iterative error in QoI} = \hbox{Total error in QoI} - \hbox{Discretization error in QoI}.
\end{equation}

\newpage
\subsection{Results}

Input parameters are {\tt $K, \alpha, restricted (0/1)$} and {\tt $iprint$}.

{\tt >> Additive\_Schwarz(2,0.5,0,0)}

norm(exact - iterative) solutions =  6.937325e-02

\begin{table}[H]
\begin{center}
\begin{tabular}{||l|c||}
\hline
Performing C iteration with error    & \\
\hline
QoI\_discretization\_error           &  8.076575e-03  \\
QoI\_discretization\_error\_estimate &  8.076575e-03  \\
QoI\_total\_error                    &  2.632966e-02  \\
QoI\_total\_error\_estimate          &  2.632966e-02  \\
QoI\_iteration\_error                &  1.825309e-02  \\
\hline
Solving U system with error          & \\
\hline
QoI\_discretization\_error\_estimate & -5.580385e-04  \\
QoI\_discretization\_error           & -5.580385e-04  \\
QoI\_total\_error                    &  1.769505e-02  \\
QoI\_total\_error\_estimate          &  1.769505e-02  \\
QoI\_iteration\_error                &  1.825309e-02  \\
\hline
\end{tabular}
\end{center}
\caption{Additive Schwarz: Two DD iterations}
\label{tab:AS_2}
\end{table}

\bigskip

{\tt >>  Additive\_Schwarz(8,0.5,0,0)}

norm(exact - iterative) solutions =  1.991954e-03

\begin{table}[H]
\begin{center}
\begin{tabular}{||l|c||}
\hline
Performing C iteration with error    & \\
\hline
QoI\_discretization\_error           &  3.418924e-02  \\
QoI\_discretization\_error\_estimate &  3.418924e-02  \\
QoI\_total\_error                    &  3.377603e-02  \\
QoI\_total\_error\_estimate          &  3.377603e-02  \\
QoI\_iteration\_error                & -4.132041e-04  \\
\hline
Solving U system with error          & \\
\hline
QoI\_discretization\_error\_estimate & -2.564992e-03  \\
QoI\_discretization\_error           & -2.564992e-03  \\
QoI\_total\_error                    & -2.978196e-03  \\
QoI\_total\_error\_estimate          & -2.978196e-03  \\
QoI\_iteration\_error                & -4.132041e-04  \\
\hline
\end{tabular}
\end{center}
\caption{Additive Schwarz: Eight DD iterations}
\label{tab:AS_8}
\end{table}






